# Computer Networking (COM2022)

*How does the Internet work?*

* Protocol: A way of communicating between multiple devices in a standardised manner
* Several layers of protocols and communication (OSI Model)
  * High level protocols (application layer) - HTTP, SMTP
  * Middle level protocols (network layer) - TCP/IP (TCP/UDP), ARP, DHCP
  * Low level protocols (transmission layer) - Ethernet, WiFi, ADSL, 3G/4G

### What does a network need to do?

* Ensure hosts **do not transmit at the same time**
* Establish **rules** to ensure that each host gets **fair access to the network**
* Have **protocols** to **route data efficiently** around the network, **minimising transmission time and wait periods**
* An **address** scheme to **uniquely identify** hosts

### Key aspects of networking

* **Data communication**: signals over wires
* **Networks**: packets over bits
* **Internet**: datagrams over packets
* **Network programming**: application data over the Internet
* **Cross functional concepts and technologies**: network configuration, control and management

#### Two key properties that protocols specify: Syntax and Semantics

* Syntax: format of messages, representation of data, encoding of signals
* Semantics: meaning of messages, procedures for exchanging messages, error handling

Protocols interact with each other in defined layers, because communication is complicated:

* ISO defines a **7-layer** model
* Internet protocols use a **5-layer** reference model

### Internet Reference Model

![Internet model](https://images-blogger-opensocial.googleusercontent.com/gadgets/proxy?url=http%3A%2F%2F3.bp.blogspot.com%2F-RhIT1iNmpnI%2FU6AEoZ43AYI%2FAAAAAAAAAWk%2FAixlvqoma_A%2Fs1600%2Ftcp-ip-layers.jpg&container=blogger&gadget=a&rewriteMime=image%2F*)

![TCP Header](http://www.insecure.in/images/TCP-Header.png)



## Description of layers

### Physical Layer

* Underlying transmission
* Multiplexing/demultiplexing
* Electrical properties, like radio frequencies and voltages
* Associated hardware

### Network Interface Layer

* Communication between a computer and its network hardware
* Datalink/MAC layer
* Hardware (MAC) addressing
* Packet formats
* Error detection

### Internet Layer

* Communication between a pair of computers over the Internet
* Internet packet format
* Internet addressing model (IPv4/IPv6) and address assignment
* Forwarding/masquerade of packets
* Dividing an Internet packet into smaller packets for transmission
* More error detection

### Transport layer

* Communication between a pair of applications
* Demultiplexing among multiple destinations on one computer
* Reliable delivery/retransmission
* Controls data rate and avoids congestion

### Application Layer

* Format and representation of data and messages
* Procedures applications follow to transfer data/handle errors
* Meaning (semantics) of messages exchanged
* Internet infrastructure such as routing/DNS

**Note**: A router only needs layer 2 *(network interface)* and layer 3 *(Internet)* software to effectively route packets across the network.



### Internet Services and Communication

* The Internet does not provide services itself. It only provides communication, and applications provide all of the services.
* Every Internet communication involves communication amongst application programs
* Internet offers two communication paradigms:
  * Stream paradigm: **TCP**, **transfers a sequence of bytes**
  * Message paradigm: **UDP**, **connectionless state**
* When using TCP:
  * Make sure that the receiver knows where a message ends
  * Read from a socket until the entire message has been acquired
* TCP includes a *push* operation that applications can use to force transmission/delivery
  * Unix convention: automatically *push* for each individual *write* call

#### Client-Server model

* One application acts as **server**, other acts as **client**

  * Server starts execution first, awaits contact
  * Client starts after server, initiates contact (`HelloServer` handshake)

* Once communication is established, data can flow **bi-directionally**

* Server handles many requests at once, is inherently **parallel**

* **The TLS handshake**, captured with `curl`:

  ```
  Alexs-MacBook-Pro:~ alexpotter1$ curl -iv https://www.google.com
  * Rebuilt URL to: https://www.google.com/
  *   Trying 216.58.213.228...
  * TCP_NODELAY set
  * Connected to www.google.com (216.58.213.228) port 443 (#0)
  * ALPN, offering h2
  * ALPN, offering http/1.1
  * Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH
  * successfully set certificate verify locations:
  *   CAfile: /etc/ssl/cert.pem
    CApath: none
  * TLSv1.2 (OUT), TLS handshake, Client hello (1):
  * TLSv1.2 (IN), TLS handshake, Server hello (2):
  * TLSv1.2 (IN), TLS handshake, Certificate (11):
  * TLSv1.2 (IN), TLS handshake, Server key exchange (12):
  * TLSv1.2 (IN), TLS handshake, Server finished (14):
  * TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
  * TLSv1.2 (OUT), TLS change cipher, Client hello (1):
  * TLSv1.2 (OUT), TLS handshake, Finished (20):
  * TLSv1.2 (IN), TLS change cipher, Client hello (1):
  * TLSv1.2 (IN), TLS handshake, Finished (20):
  * SSL connection using TLSv1.2 / ECDHE-ECDSA-AES128-GCM-SHA256
  * ALPN, server accepted to use h2
  * Server certificate:
  *  subject: C=US; ST=California; L=Mountain View; O=Google Inc; CN=www.google.com
  *  start date: Feb 13 10:41:32 2018 GMT
  *  expire date: May  8 10:39:00 2018 GMT
  *  subjectAltName: host "www.google.com" matched cert's "www.google.com"
  *  issuer: C=US; O=Google Inc; CN=Google Internet Authority G2
  *  SSL certificate verify ok.
  * Using HTTP2, server supports multi-use
  * Connection state changed (HTTP/2 confirmed)
  * Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0
  * Using Stream ID: 1 (easy handle 0x7f8dde805800)
  > GET / HTTP/2
  > Host: www.google.com
  > User-Agent: curl/7.54.0
  > Accept: */*
  ```

* Uses **sockets** (internal endpoints for sending/receiving data at a single node in a computer network)

####  

#### Application layer protocol

* HTTP

  * HTTP request types: `GET`, `POST`, `PATCH/PUT`, `DELETE`

* Email

  * SMTP

    * Uses the stream paradigm

    * Only transfers textual messages

    * Terminates messages with `<CR><LF>.<CR><LF>`

    * Sends one copy only of a message to a computer

    * <img src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/02/59/SMTP%20filter.png" width="85%">

      ​

  * POP3

  * IMAP

  * Non-textual email: **S/MIME**

* FTP

  * Control channel, data channel
  * Server forms data connection for each file transferred
  * Server closes data connection after each transfer is complete

* Remote login: SSH/Telnet

* DNS

  * Hierarchical structure
  * Resolves domain names to IP addresses
  * Resolutions are cached positively/negatively

### Topology of the Internet

* How to link computers (nodes) if there are several of them?
  * Which is the most efficient routing?
  * What happens if computers drop out/disconnect from the network? Are others still reachable?
  * What if physical links fail/corrode/are cut?
* A very naïve solution: physical connections between **all** nodes
  * Number of physical connections grow quadratically as more nodes are connected to the network
  * Obviously, not optimal for networks at scale
* A better solution: Each node is connected to a **shared bus**
  * Shared, high-bandwidth main link
  * Addresses could be a problem
  * Multiple nodes transmitting *simultaneously* could be an issue (multiplexing/bandwidth availability/QoS prioritisation)
* An alternative solution: Nodes are connected by a **ring system**
  * Nodes can 'help' each other
  * Distant nodes can be connected indirectly by intermediary nodes
* Other models/topologies exist
  * **Hub/Spoke networks**
  * **Star networks**
  * **Mesh networks**
  * **Tree networks**

#### Packets

* Data is divided into small units, called **packets**
* Packets are forwarded through the network similar to how a courier/Post Office system handles letters and parcels
  * Sender breaks the data into pieces, encapsulates them into packets, defines the origin/destination addresses, and sends them through an available network interface
  * Sender/receiver isn't actually aware of the path of the packets through the network
    * The route can be traced after transmission though by **packet header reconstruction**, unless onion routing protocols/anonymisers like **Tor** are used

#### Requirements of a computer network

Essentially:

* Physical links between nodes are needed
* Mechanisms are needed to sharing shared communication media
* Other mechanisms are needed for forwarding messages by intermediaries
* Even more mechanisms are needed to ensure redundancy across the network; so that, if computers disconnect, then computers at one end of a network can reach others

Every node that participates in the network needs technologies to ensure that these requirements are satisfied, to ensure that network stability, security, speed and the ability to communicate are maintained.

What we hope to achieve therefore, is to allow **logical connections** amongst all nodes. Thus, every node can *technically* be connected to every other node, but not directly and not necessarily through physical means. 

* For example, **VPNs** can achieve a logical connection between two computers, or even two networks that may be geographically isolated from one another. A virtual, logical **tunnel** is created that passes through several routers and nodes between the two networks, but to the endpoints, they seem to be connected directly.
  * Encryption can also be layered on top of this tunnel to protect and obfuscate data from nodes that may be trying to eavesdrop on communications between the endpoints.
  * Using VPNs is a popular way to change your detected location, so for example if you are based in London but you connect to an endpoint in Amsterdam over *OpenVPN*, many internet services will detect that you are in Amsterdam and serve Netherlands-specific versions of their content rather than UK-specific content (such as Netflix, Google, etc).
    * This is used by many internet activists to circumvent state-sponsored censorship of digital content.
    * Many firewalls and routers can't actually detect that a VPN technology such as OpenVPN is being used if traffic is layered on top of a commonly used port that deals with encrypted data (like TLS - *TCP 443*), **unless the firewall/IDS is using Deep Packet Inspection (DPI) methods**. 
      * The Chinese, Russian, Malaysian, Syrian and Egyptian governments have been known for using Deep Packet Inspection to censor content and drop Internet connections.

#### Logical System Architecture of Internet-connected systems

* A **network interface** is a combination of hardware and software components to implement the requirements of computer networks, discussed above.
  * The hardware part is called a **Network Interface Card (NIC)**, and may be connected to the computer over **USB**, or **PCI Express**.
* Computer-to-computer communication is handled over several layers
  * OSI Model, discussed above
  * Packet data is encapsulated for each layer, and then unwrapped in reverse on the receiving system
* Routers forward packets across networks, and **network interfaces**
  * Routers can also **masquerade** packets, using **network address translation (NAT)** to allow everyone on an internal network to share one external address, and the router forwards packets to each computer inside the internal network
    * Many internet service providers enforce NAT on their routers, as the **IPv4 address space** is very quickly **running out of unique addresses**. Transitioning to IPv6 helps this greatly.





